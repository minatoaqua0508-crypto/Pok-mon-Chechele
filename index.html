<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¥å¥‡å¯¶è²åˆ‡åˆ‡æ¨‚</title>
    <meta name="description" content="ç¥å¥‡å¯¶è²åˆ‡åˆ‡æ¨‚">
  <meta name="keywords" content="ç¥å¥‡å¯¶è²åˆ‡åˆ‡æ¨‚,ç¥å¥‡å¯¶è², åˆ‡åˆ‡æ¨‚,å¯¶å¯å¤¢,">
  <meta name="author" content="é»ƒéŸ‹å‚‘å­¸è€…">
  <meta property="og:title" content="ç¥å¥‡å¯¶è²åˆ‡åˆ‡æ¨‚">
  <meta property="og:description" content="ç¥å¥‡å¯¶è²">
  <meta property="og:image" content="https://github.com/minatoaqua0508-crypto/Pok-mon-Chechele//images/logo3.jpg">

  <meta property="og:url" content="https://github.com/minatoaqua0508-crypto/Pok-mon-Chechele//index.html">
  <meta property="og:type" content="website">
<meta property="og:site_name" content="ç¥å¥‡å¯¶è²åˆ‡åˆ‡æ¨‚">
<meta name="robots" content="index, follow">
<link rel="canonical" href="https://github.com/minatoaqua0508-crypto/Pok-mon-Chechele//index.html">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
       * {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Arial', sans-serif;
  background: #f8f2ee;
  overflow: hidden;
  user-select: none;
  height: 100vh;
  display: flex;
  flex-direction: column; /* ä¸Šä¸‹æ’åˆ—ï¼šä¸Šæ–¹å·¥å…·åˆ— + ä¸‹æ–¹éŠæˆ² */
}
.credit {
        position: fixed;         /* å›ºå®šåœ¨è¦–çª—ï¼Œè€Œä¸æ˜¯è·Ÿè‘—å…§å®¹ */
        bottom: 10px;            /* è·é›¢åº•éƒ¨ 10px */
        right: 10px;             /* è·é›¢å³é‚Š 10px */
        font-size: 12px;         /* å­—é«”å°ä¸€é» */
        color: rgba(0, 0, 0, 0.3); /* åŠé€æ˜ç°è‰² */
        font-style: italic;      /* æ–œé«” */
        pointer-events: none;    /* ä¸å½±éŸ¿æ»‘é¼ é»æ“Š */
        user-select: none;       /* ä¸èƒ½é¸å–æ–‡å­— */
    }
.game-container {
  flex: 1; /* éŠæˆ²å€åŸŸå¡«æ»¿å‰©é¤˜ç©ºé–“ */
  display: flex;
  width: 100%;
}

.game-area {
  flex: 1;
  position: relative;
  background: linear-gradient(135deg, #B7E0FF 0%, #FFF5CD 100%);/* èƒŒæ™¯è‰² */
  overflow: hidden;
  cursor: crosshair;
  touch-action: none;       /* è®“è§¸æ§äº‹ä»¶ä¸è¢«æ²å‹•åƒæ‰ */
  overscroll-behavior: contain;
}

.score-display {
  position: absolute;
  top: 20px;
  left: 20px;
  font-size: 24px;
  font-weight: bold;
  color: #4A4A4A;
  z-index: 1000;
}

.sidebar {
  position: relative; /* ç‚ºé®ç½©å®šä½ */
  width: 100%;
  min-height: 60px;
  background: url("imags/logo00.jpg") center/cover no-repeat;
  padding: 8px 20px;
  display: flex;
  align-items: flex-start;
  gap: 30px;
  flex: 0 0 auto;
}

.sidebar::before {
  content: "";
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,.18); /* é®ç½©æ¿ƒæ·¡å¯èª¿ */
  pointer-events: none;
}
/* å¦‚æœç”¨äº†é®ç½©ï¼Œè®“å…§å®¹åœ¨é®ç½©ä¹‹ä¸Š */
.sidebar > * { position: relative; z-index: 1; }

/* title */
.sidebar-section h2 {
  font-size: 40px;
  font-weight: 700;
  margin-bottom: 6px;
  text-align: center;

 
  
}

/* éŠæˆ²æ¨™é¡Œæ¬„ä½ */
.sidebar-section.game-title {
  width: 300px;
  min-height: 80px;
  background: linear-gradient(180deg, #BBDCE5 0%, #ECEEDF 100%);/* èƒŒæ™¯è‰² */
  
  border-radius: 8px;
  padding: 35px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  display: flex;
  flex-direction: column;  /* å‚ç›´æ’åˆ— */
  align-items: center;
  justify-content: flex-start;
  gap: 10px;  /* æ¨™é¡Œèˆ‡æŒ‰éˆ•é–“è· */
}

/* again æŒ‰éˆ• */
.again-btn {
  padding: 8px 14px;
  border: none;
  border-radius: 5px;
 background: linear-gradient(135deg, #D9C4B0 0%, #CFAB8D 100%); /* èƒŒæ™¯è‰² */
 border: 1px solid #000; /* å¤–é»‘æ¡† */
  border-radius: 8px;
  color: black;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.again-btn:hover {
  background: linear-gradient(45deg, #CFAB8D 0%, #D9C4B0 100%); /* èƒŒæ™¯è‰² */
  border-radius: 8px;
  transform: scale(1.05);
}

/* æ­·å²æœ€é«˜åˆ†æ•¸ */
.sidebar-section h3 {
  font-size: 20px;
  font-weight: bold;

  background: linear-gradient(180deg, #B9375D 0%,  #D25D5D 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;

  margin-bottom: 8px;
  text-align: center;
  
}

/* æ­·å²æœ€é«˜åˆ†æ•¸æ¬„ä½ */
.sidebar-section.high-score {
  width: 300px;
  min-height: 80px;
   background: linear-gradient(180deg, #CADCAE 0%, #E1E9C9 100%);
  border-radius: 8px;
  padding: 36px;
  display: flex;
  flex-direction: column;  /* å‚ç›´æ’åˆ— */
  align-items: center;
  justify-content: flex-start;
  gap: 10px; /* æ¨™é¡Œèˆ‡æŒ‰éˆ•é–“è· */
  color: black;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

/* stop æŒ‰éˆ• */
#pauseBtn {
  padding: 8px 14px;
  border: none;
  border-radius: 5px;
   background: linear-gradient(135deg, #EDA35A 0%, #FEE8D9 100%); /* èƒŒæ™¯è‰² */
   border: 1px solid #000; /* å¤–é»‘æ¡† */
  color: black;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.3s ease;
}

#pauseBtn:hover {
 background: linear-gradient(135deg, #FEE8D9 0%, #EDA35A 100%); /* èƒŒæ™¯è‰² */
  transform: scale(1.05);
}

/* .music-player  */
.sidebar-section.fruit-info.music-player {
  /* ä¿ç•™ä½  .fruit-info çš„èƒŒæ™¯ã€paddingã€åœ“è§’ã€é–“è·ç­‰ï¼Œä¸è¦†è“‹å°±æ²¿ç”¨ */
  display: flex;
  flex-direction: column;
  gap: 8px; /* æ¨™é¡Œèˆ‡æŒ‰éˆ•é–“è· */
   padding: 48px 60px;
   border-radius: 10px;
}

/* æ¨™é¡Œ h4 */
.sidebar-section.fruit-info.music-player h4 {
  font-size: 18px;        /* æ¯”åŸ 20px ä½èª¿ */
  font-weight: 800;
  color: #000000;
  margin-bottom: 6px;
  text-align: center;
  line-height: 1.2;
  word-break: break-all;
}

/* æ’­æ”¾å™¨æŒ‰éˆ•åˆ— */
.sidebar-section.fruit-info.music-player .player-controls {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 18px;
}

/* æŒ‰éˆ•å¤–è§€ */
.sidebar-section.fruit-info.music-player .btn-icon {
  appearance: none;
  border: none;
  outline: none;
  background: linear-gradient(180deg, #BDE3C3 0%, #A3CCDA 100%);
  color: #fff;
  width: 44px;
  height: 44px;
  border-radius: 999px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(0,0,0,.25);
  transition: transform .15s ease, background .15s ease, opacity .15s ease;
}

.sidebar-section.fruit-info.music-player .btn-icon.play {
  width: 56px;
  height: 56px; /* ä¸­é–“éµè¼ƒå¤§ */
}

.sidebar-section.fruit-info.music-player .btn-icon:hover { transform: scale(1.06); }
.sidebar-section.fruit-info.music-player .btn-icon:active { transform: scale(0.95); }
.sidebar-section.fruit-info.music-player .player-controls svg { display: block; }

/* æ·±è‰²å®¹å™¨ä¸Šæ›´ä½èª¿ï¼šåªé‡å°æ’­æ”¾å™¨é‚£ä¸€æ ¼ */
.sidebar-section.fruit-info.music-player {
 background: linear-gradient(180deg, #F5D2D2 0%, #F8F7BA 100%);
}





/* ç©åˆ†å…Œæ› */
.sidebar-section h5 {
  font-size: 16px;  /* ç©åˆ†å…Œæ› */
  font-weight: 500;
  color: #01090e;   /* æ·¡è—è‰² */
  margin-bottom: 6px;
}

/* ç©åˆ†å…Œæ›æ¬„ä½èª¿æ•´ */
.sidebar-section.exchange {
  width: 240px;          /* å›ºå®šå¯¬åº¦ */
  min-height: 160px;     /* å›ºå®šé«˜åº¦ */
  background: linear-gradient(180deg, #BBDCE5 0%, #ECEEDF 100%);/* èƒŒæ™¯è‰² */
  border-radius: 8px;    /* åœ“è§’ */
  padding: 1px;          /* å…§è· */
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  gap: 8px;              /* æ¨™é¡Œèˆ‡æŒ‰éˆ•é–“è· */
  color: white;
  padding-bottom: 10px;  /* ä¿è­‰æœ€å¾ŒæŒ‰éˆ•åº•ä¸‹æœ‰ç©ºé–“ */
}

/* ğŸ¯ æŒ‰éˆ•çµ±ä¸€æ¨£å¼ */
.sidebar-section.exchange button {
  width: 200px;          /* çµ±ä¸€å¯¬åº¦ */
  height: 40px;          /* çµ±ä¸€é«˜åº¦ */
  border: none;
  border-radius: 5px;
  background: linear-gradient(180deg, #59D5E0 0%, #F5DD61 100%);
  border: 1px solid #000; /* å¤–é»‘æ¡† */
  color: black;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.3s ease;
}

/* ğŸ¯ æŒ‰éˆ• hover æ•ˆæœ */
.sidebar-section.exchange button:hover:enabled {
  background: linear-gradient(180deg,#F5DD61 0%, #59D5E0 100%);
  transform: scale(1.05);
}

/* ğŸ¯ åœç”¨ç‹€æ…‹ä¿æŒåŸç¨‹å¼æ©Ÿåˆ¶ */
.sidebar-section.exchange button:disabled {
  background: #888;      /* ç°è‰² (ä¿ç•™åŸæ©Ÿåˆ¶) */
  cursor: not-allowed;
  transform: none;
}

/* å…ˆæŠŠé é¢åº•è‰²çµ±ä¸€ç‚ºå’–å•¡è‰²ï¼Œé¿å…ä»»ä½•åœ°æ–¹éœ²ç™½ */
html, body { background:#D2B48C !important; }

.fruit-img[src*="roc1.jpg"],
.fruit-img[src*="roc2.png"],
.fruit-img[src*="roc3.webp"],
.fruit-img[src*="roc4.png"]
 {
  width: 100px;
  height: 100px;
  border-radius: 20px;
  object-fit: cover;     /* âœ… ä¿æŒæ¯”ä¾‹å¡«æ»¿ï¼Œä¸æœƒè®Šå½¢ */
}
/* æ¡Œæ©Ÿé è¨­ï¼šæ‰€æœ‰æ°´æœåœ–ç‰‡éƒ½æ˜¯ 100x100 */

.fruit-img[src*="logo1.png"],
.fruit-img[src*="logo2.jpg"],
.fruit-img[src*="logo3.jpg"],


.fruit-img[src*="logo4.png"],
.fruit-img[src*="logo5.png"],
.fruit-img[src*="logo6.png"],
.fruit-img[src*="logo7.png"],
.fruit-img[src*="logo8.png"],
.fruit-img[src*="logo9.png"],
.fruit-img[src*="logo10.png"],
.fruit-img[src*="logo11.png"],
.fruit-img[src*="logo12.png"],
.fruit-img[src*="logo13.png"],
.fruit-img[src*="logo14.png"],
.fruit-img[src*="logo15.png"],
.fruit-img[src*="logo16.png"],
.fruit-img[src*="logo17.png"],
.fruit-img[src*="logo18.png"],
.fruit-img[src*="logo19.png"],
.fruit-img[src*="logo20.png"],
.fruit-img[src*="logo21.png"]
 {
  width: 100px;
  height: 100px;
  border-radius: 100px;   /* âœ… åŠ ä¸Šåœ“è§’è¨­è¨ˆ */
  object-fit: cover;     /* âœ… ä¿æŒæ¯”ä¾‹å¡«æ»¿ï¼Œä¸æœƒè®Šå½¢ */
}


/* æ‰‹æ©Ÿç‰ˆï¼ˆå¯¬åº¦ â‰¤390pxï¼‰ï¼šç¸®å°æ°´æœåœ–ç‰‡ */
@media (max-width: 450px) {

.fruit-img[src*="logo1.png"],
.fruit-img[src*="logo2.jpg"],
.fruit-img[src*="logo3.jpg"],

  
 .fruit-img[src*="logo4.png"],
.fruit-img[src*="logo5.png"],
.fruit-img[src*="logo6.png"],
.fruit-img[src*="logo7.png"],
.fruit-img[src*="logo8.png"],
.fruit-img[src*="logo9.png"],
.fruit-img[src*="logo10.png"],
.fruit-img[src*="logo11.png"],
.fruit-img[src*="logo12.png"],
.fruit-img[src*="logo13.png"],
.fruit-img[src*="logo14.png"],
.fruit-img[src*="logo15.png"],
.fruit-img[src*="logo16.png"],
.fruit-img[src*="logo17.png"],
.fruit-img[src*="logo18.png"],
.fruit-img[src*="logo19.png"],
.fruit-img[src*="logo20.png"],
.fruit-img[src*="logo21.png"]
{
    width: 50px;   /* ç¸®å°å°ºå¯¸ */
    height: 50px;
    border-radius: 100px;   /* âœ… å°è¢å¹•ç¸®å°ï¼Œä½†ä»ä¿ç•™åœ“è§’ */
    object-fit: cover;
  }
 .fruit-img[src*="roc1.jpg"],
.fruit-img[src*="roc2.png"],
.fruit-img[src*="roc3.webp"],
.fruit-img[src*="roc4.png"]
 {
  width: 50px;
  height: 50px;
  border-radius: 10px;
  object-fit: cover;     /* âœ… ä¿æŒæ¯”ä¾‹å¡«æ»¿ï¼Œä¸æœƒè®Šå½¢ */
}
}


        .fruit {
            position: absolute;
            font-size: 40px;
            z-index: 100;
            transition: all 0.1s ease;
        }

        .bomb {
            position: absolute;
            font-size: 40px;
            z-index: 100;
        }

        .slice-line {
            position: absolute;
            height: 3px;
            background: linear-gradient(90deg, #FFD700, #FFA500);
            border-radius: 2px;
            pointer-events: none;
            z-index: 50;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.7);
        }

        @keyframes sliceEffect {
            0% { 
                transform: scale(1) rotate(0deg); 
                opacity: 1; 
            }
            50% { 
                transform: scale(1.2) rotate(180deg); 
                opacity: 0.7; 
            }
            100% { 
                transform: scale(0.8) rotate(360deg); 
                opacity: 0; 
            }
        }

        .sliced {
            animation: sliceEffect 0.8s ease-out forwards;
        }

        .special-fruit {
            position: absolute;
            font-size: 60px;
            z-index: 90;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
             width: 60px; height: 60px;  /* æ²’æœ‰å°±è£œä¸Šï¼›æœ‰å‹•æ…‹å°ºå¯¸ä¹Ÿå¯ */
  touch-action: none;         /* å…ƒä»¶æœ¬èº«ä¹Ÿåœç”¨é è¨­æ‰‹å‹¢ */
        }

        .special-fruit:hover {
            transform: scale(1.1);
            filter: brightness(1.2);
        }

        .special-fruit:active {
            transform: scale(0.95);
        }

        @keyframes touchReaction {
            0% { transform: scale(1); }
            50% { transform: scale(1.3) rotate(10deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        .special-fruit.touched {
            animation: touchReaction 0.5s ease-out;
        }

        

        
.special-fruit img {
  width: 70px;
  height: 70px;
  object-fit: contain;
}
.special-fruit, .special-red {
  position: absolute;
  cursor: grab;
}
/* special-red èˆ‡ special-fruit ä¸€æ¨£çš„äº’å‹•/å‹•ç•«æ•ˆæœ */
.special-red {
  position: absolute;
  z-index: 90;
  width: 60px;
  height: 60px;
  cursor: grab;                        /* è¢«ä½ å‰é¢çš„åˆä½µé¸æ“‡å™¨è¦†è“‹æ™‚ï¼Œé€™æ®µéœ€æ”¾å¾Œé¢ */
  transition: transform .3s ease, filter .3s ease;
  user-select: none;
  touch-action: none;
  will-change: transform, filter;
}

.special-red:hover {
  transform: scale(1.1);
  filter: brightness(1.2);
}

.special-red:active {
  transform: scale(0.95);
}

/* å¥—ç”¨èˆ‡ special-fruit ç›¸åŒçš„å‹•ç•« */
.special-red.touched {
  animation: touchReaction 0.5s ease-out;
}

/* åœ–ç‰‡å°ºå¯¸èˆ‡è¡Œç‚ºï¼ˆç›®å‰ä½ çš„ fruit æ˜¯ 70x70ï¼‰*/
.special-red img {
  width: 70px;
  height: 70px;
  object-fit: contain;
  -webkit-user-drag: none;
  pointer-events: none;
}
             
        

        

        @media (max-width: 768px) {
            .sidebar {
                width: 200px;
                margin-right: 10px;
                padding: 15px;
            }
            
            .fruit, .bomb {
                font-size: 35px;
            }
            
            .score-display {
                font-size: 20px;
            }
        }
        
:root{
  --drawer-handle: 36px; /* æ”¶ç´æ™‚çš„ä¿ç•™é«˜åº¦(å°æ©«æ¢é«˜åº¦) */
}

/* â–¶ é è¨­ï¼šå³ä¸Šè§’ */
.drawer-toggle{
  position: absolute;
  top: 8px;
  right: 10px;         /* â† å³ä¸Š */
  left: auto;
 width: 40px;         /* 28 â†’ 40 */
  height: 40px;        /* 28 â†’ 40 */
  line-height: 40px;   /* è®“å­—å‚ç›´ç½®ä¸­ */
  font-size: 20px;     /* 16 â†’ 20ï¼Œç®­é ­æ›´å¤§ */
  border: 0;
  border-radius: 50%;
  background: #333;
  color: #fff;
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(0,0,0,.25);
  transition: transform .25s ease, background .25s ease;
  z-index: 10;         /* è“‹éé¢æ¿å…§å…¶ä»–å…ƒç´  */
}
.drawer-toggle:hover{ transform: scale(1.06); }

/* è®“ sidebar æ”¯æ´é«˜åº¦å‹•ç•« */
.sidebar{
  position: relative;
  transition: height .25s ease, padding .25s ease, background .25s ease, box-shadow .25s ease;
}

/* â–¶ æ”¶ç´ï¼šæ•´å€‹ sidebar æ”¶èµ· */
body.drawer-collapsed .sidebar{
  height: 0;
  min-height: 0;
  padding: 0;
  border: 0;
  box-shadow: none;
  background: transparent;
  overflow: hidden;
}

/* â–¶ æ”¶ç´æ™‚ï¼šåˆ‡æ›éµå›ºå®šå³ä¸Šè§’ï¼ˆä¸å— sidebar å½±éŸ¿ï¼‰ */
body.drawer-collapsed .drawer-toggle{
  position: fixed;
  top: max(10px, env(safe-area-inset-top));
  right: max(10px, env(safe-area-inset-right));  /* â† å³ä¸Š */
  left: auto;
   width: 44px;         /* 32 â†’ 44 */
  height: 44px;        /* 32 â†’ 44 */
  line-height: 44px;
  font-size: 22px;     /* ç¬¦è™Ÿæ›´æ¸…æ¥š */
  border: 0;
  border-radius: 50%;
  background: #222;
  color: #fff;
  z-index: 1002;  /* è“‹åœ¨éŠæˆ²å€ä¸Šæ–¹ */
  box-shadow: 0 2px 6px rgba(0,0,0,.25);
}

/* â–¶ å°è¢å¹•å¾®èª¿ï¼ˆé¿å…è²¼é‚Š/ç€æµ·ï¼‰ */
@media (max-width: 390px){
  .drawer-toggle{
    top: 6px;
    right: max(8px, env(safe-area-inset-right));
    left: auto;
  }
}

/* ====== 450px ä»¥ä¸‹ï¼šå·¥å…·åˆ— full-bleed + ä¸è¢«æ“ å£“ ====== */
@media (max-width: 450px){

  /* ç›´æ’ï¼šå·¥å…·åˆ—åœ¨ä¸Šã€éŠæˆ²åœ¨ä¸‹ */
  .game-container{
    display:flex;
    flex-direction:column;
  }
  .game-container > .sidebar{ order:1; }
  .game-container > .game-area{ order:2; }

  /* å·¥å…·åˆ—æ”¹æˆ 2 æ¬„ Grid + Full-Bleed */
  .sidebar{
    display:grid !important;
    grid-template-columns: 1fr 1fr;
    grid-template-areas:
      "game-title fruit-info"
      "high-score  exchange";
    gap:12px;

    /* full-bleed è¦†è“‹å·¦å³ç™½é‚Š */
    width:100vw;
    margin-left: calc(50% - 50vw);
    margin-right:calc(50% - 50vw);
    padding:10px 12px;
    box-sizing:border-box;

    /* å®‰å…¨å€ */
    padding-left:  max(12px, env(safe-area-inset-left));
    padding-right: max(12px, env(safe-area-inset-right));
  }
  @supports (width: 100svw){
    .sidebar{
      width:100svw;
      margin-left: calc(50% - 50svw);
      margin-right:calc(50% - 50svw);
    }
  }

  /* é¿å… full-bleed é€ æˆæ°´å¹³å·è»¸ */
  html, body{ overflow-x:hidden !important; }

  /* æŒ‡å®šå››å¡ç‰‡å°æ‡‰ä½ç½® */
  .sidebar .game-title, .sidebar-section.game-title{ grid-area: game-title; }
  .sidebar .fruit-info, .sidebar-section.fruit-info{ grid-area: fruit-info; }
  .sidebar .high-score, .sidebar-section.high-score{ grid-area: high-score; }
  .sidebar .exchange,  .sidebar-section.exchange { grid-area: exchange; }

  /* ğŸ”§ é—œéµï¼šå¾¹åº•è§£é™¤æ¡Œæ©Ÿçš„å›ºå®šå¯¬é«˜ï¼Œå…è¨±åœ¨ Grid å…§ç¸®æ”¾ */
  .sidebar-section,
  .sidebar .game-title,
  .sidebar .high-score,
  .sidebar .exchange,
  .sidebar .fruit-info,
  .sidebar-section.game-title,
  .sidebar-section.high-score,
  .sidebar-section.exchange,
  .sidebar-section.fruit-info{
    width: 100% !important;
    max-width: none !important;
    min-width: 0 !important;
    min-height: auto !important;
    padding: 10px 12px !important;
    border-radius: 6px;
    box-shadow: 0 2px 6px rgba(0,0,0,.15);
    justify-self: stretch !important;
  }

.sidebar-section.game-title{
    min-height: auto !important;     /* é«˜åº¦è‡ªé©æ‡‰ */
    padding: 19px !important;        /* å…§è·ç¸®å° */
    font-size: 14px !important;      /* æ¨™é¡Œå­—ç¸®å° */
    gap: 6px !important;             /* å…§å®¹é–“è·ç¸®å° */
  }

  .sidebar-section.fruit-info.music-player h4 {
  font-size: 15px;        /* æ¯”åŸ 20px ä½èª¿ */
  
}


  .sidebar-section.high-score{
    min-height: auto !important;     /* é«˜åº¦è‡ªé©æ‡‰ */
    padding: 39px !important;        /* å…§è·ç¸®å° */
    font-size: 14px !important;      /* æ¨™é¡Œå­—ç¸®å° */
    gap: 6px !important;             /* å…§å®¹é–“è·ç¸®å° */
  }


  /* ä»»ä½•ç›´æ¥å­å…ƒç´ æœ€å°å¯¬åº¦æ­¸é›¶ï¼Œé¿å…å…§å®¹æŠŠæ ¼å­æ’çˆ† */
  .sidebar > *{ min-width:0 !important; }

  

  /* å…§å®¹å¾®èª¿é˜²æ“ çˆ† */
  .sidebar-section h2{ font-size:16px; margin-bottom:4px; }
  .sidebar-section h3{ font-size:14px; margin-bottom:12px; }
  .sidebar-section h4{ font-size:15px; margin-bottom:4px; }
  .sidebar-section h5{ font-size:14px; margin-bottom:4px; }

  .sidebar-section.fruit-info{ gap:6px; }
  .sidebar-section.fruit-info .fruit{
    padding:1px 8px;
    font-size:13px;
    line-height:1.35;
  }

  /* æŒ‰éˆ•åœ¨å°è¢å¹•æ‹‰æ»¿å¯¬ */
  .again-btn,
  #pauseBtn,
  .sidebar-section.exchange button{
    width:100% !important;
    height:36px;
    font-size:11px;
  }

  /* Drawer åˆ‡æ›éµï¼ˆè‹¥æœ‰ï¼‰é¿å…è²¼é‚Š/ç€æµ· */
  .drawer-toggle{
    top:6px;
    right:max(8px, env(safe-area-inset-right));
  }
  .credit {
        position: fixed;         /* å›ºå®šåœ¨è¦–çª—ï¼Œè€Œä¸æ˜¯è·Ÿè‘—å…§å®¹ */
        bottom: 10px;            /* è·é›¢åº•éƒ¨ 10px */
        right: 10px;             /* è·é›¢å³é‚Š 10px */
        font-size: 8px;         /* å­—é«”å°ä¸€é» */
        color: rgba(0, 0, 0, 0.3); /* åŠé€æ˜ç°è‰² */
        font-style: italic;      /* æ–œé«” */
        pointer-events: none;    /* ä¸å½±éŸ¿æ»‘é¼ é»æ“Š */
        user-select: none;       /* ä¸èƒ½é¸å–æ–‡å­— */
    }
}



    </style>
</head>
<body>
    <!-- ä¸Šæ–¹å·¥å…·åˆ— -->
    <div class="sidebar">
        <button class="drawer-toggle" aria-expanded="true" onclick="toggleDrawer(this)">â¬†</button>
        <!-- éŠæˆ²æ¨™é¡Œ + Again -->
        <div class="sidebar-section game-title">
    <h2>ã€Šç¥å¥‡å¯¶è²ã€‹</h2>
    <button class="again-btn" onclick="restartGame()">again (é‡æ–°)</button>
</div>

<!-- æ­·å²åˆ†æ•¸ + Stop -->
<div class="sidebar-section high-score">
    <h3>æ­·å²æœ€é«˜åˆ†æ•¸</h3>
    <div id="highScore">0</div>
    <button id="pauseBtn" onclick="togglePause()">stop (æš«åœ)</button>
</div>

<!-- æ’¥æ”¾å™¨ -->
        <div class="sidebar-section fruit-info music-player">
  <h4 id="trackTitle">æ­Œåé¡¯ç¤ºå€</h4>

  <div class="player-controls">
    <button class="btn-icon" id="btnPrev" aria-label="ä¸Šä¸€é¦–" title="ä¸Šä¸€é¦–">
      <!-- â® -->
      <svg viewBox="0 0 24 24" width="28" height="28"><path fill="currentColor" d="M6 5h2v14H6V5zm3.5 7L20 19V5L9.5 12z"/></svg>
    </button>

    <button class="btn-icon play" id="btnPlay" aria-label="æ’­æ”¾/æš«åœ" title="æ’­æ”¾/æš«åœ">
      <!-- â¯ åˆå§‹é¡¯ç¤ºã€Œæ’­æ”¾ã€åœ–ç¤º -->
      <svg id="iconPlay" viewBox="0 0 24 24" width="28" height="28"><path fill="currentColor" d="M8 5v14l11-7z"/></svg>
      <svg id="iconPause" viewBox="0 0 24 24" width="28" height="28" style="display:none"><path fill="currentColor" d="M6 5h4v14H6V5zm8 0h4v14h-4V5z"/></svg>
    </button>

    <button class="btn-icon" id="btnNext" aria-label="ä¸‹ä¸€é¦–" title="ä¸‹ä¸€é¦–">
      <!-- â­ -->
      <svg viewBox="0 0 24 24" width="28" height="28"><path fill="currentColor" d="M18 5h-2v14h2V5zM14.5 12L4 19V5l10.5 7z"/></svg>
    </button>
  </div>

  <audio id="audioPlayer" preload="metadata"></audio>
</div>

        <!-- ç©åˆ†å…Œæ› (å‚ç›´æ’åˆ—) -->
        <div class="sidebar-section exchange">
            <h5>ç©åˆ†å…Œæ›</h5>
            <button onclick="spawnSpecialFruit()" id="specialBtn" disabled>
                10 Point â†’ æ™®é€šåœ–ç‰‡  (6ç¨®)
            </button>
            <button onclick="changeBackgroundRandomBlue()" id="blueBtn" disabled>
                20 Point â†’ æ›èƒŒæ™¯  (12ç¨®)
            </button>
            <button onclick="spawnRedEffect()" id="redBtn" disabled>
                50 Point â†’ é«˜ç´šåœ–ç‰‡  (7ç¨®)
            </button> 
        </div>
    </div>

    <!-- ä¸‹æ–¹éŠæˆ²å€åŸŸ -->
    <div class="game-container">
        <div class="game-area" id="gameArea">
            <div class="score-display">Point: <span id="score">0</span></div>
        </div>
    </div>


    <script>
        let gameArea = document.getElementById('gameArea');
        let scoreElement = document.getElementById('score');
        let highScoreElement = document.getElementById('highScore');
        let pauseBtn = document.getElementById('pauseBtn');
        
        let score = 0;
        let highScore = localStorage.getItem('fruitNinjaHighScore') || 0;
        let sessionHighScore = 0; // æœ¬å±€éŠæˆ²çš„æœ€é«˜åˆ†æ•¸
        let isPaused = false;
        let fruits = [];
        let specialFruits = [];
        let sliceLines = [];
        
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;
        
       const fruitImages = [
        'imags/logo1.png', 
       
        'imags/logo4.png',
        'imags/logo5.png',
        'imags/logo6.png',
        'imags/logo7.png',
        'imags/logo8.png',
        'imags/logo9.png',
        'imags/logo10.png',
        'imags/logo11.png',
        'imags/logo12.png',
        'imags/logo13.png',
        'imags/logo14.png',
        'imags/logo15.png',
        'imags/logo16.png',
        'imags/logo17.png',
        'imags/logo18.png',
        'imags/logo19.png',
        'imags/logo20.png',
        'imags/logo21.png',
    ];


const bombImages = [
    'imags/roc1.jpg',
    'imags/roc2.png',
    'imags/roc4.png' ];




const slicedImages = {
    'imags/roc1.jpg': 'imags/roc3.webp',
    'imags/roc2.png': 'imags/roc3.webp',
    'imags/roc4.png': 'imags/roc3.webp',


    'imags/logo1.png': 'imags/logo3.jpg',
   
    'imags/logo4.png': 'imags/logo3.jpg',
    'imags/logo5.png': 'imags/logo3.jpg',
    'imags/logo6.png': 'imags/logo3.jpg',
    'imags/logo7.png': 'imags/logo3.jpg',
    'imags/logo8.png': 'imags/logo3.jpg',
    'imags/logo9.png': 'imags/logo3.jpg',
    'imags/logo10.png': 'imags/logo3.jpg',
    'imags/logo11.png': 'imags/logo3.jpg',
    'imags/logo12.png': 'imags/logo3.jpg',
    'imags/logo13.png': 'imags/logo3.jpg',
    'imags/logo14.png': 'imags/logo3.jpg',
    'imags/logo15.png': 'imags/logo3.jpg',
    'imags/logo16.png': 'imags/logo3.jpg',
    'imags/logo17.png': 'imags/logo3.jpg',
    'imags/logo18.png': 'imags/logo3.jpg',
    'imags/logo19.png': 'imags/logo3.jpg',
    'imags/logo20.png': 'imags/logo3.jpg',
    'imags/logo21.png': 'imags/logo3.jpg',
};
        // åˆå§‹åŒ–
        highScoreElement.textContent = highScore;
        sessionHighScore = 0; // åˆå§‹åŒ–æœ¬å±€æœ€é«˜åˆ†æ•¸
        
        // ç”Ÿæˆæ°´æœå’Œç‚¸å½ˆ
function spawnFruit() {
    if (isPaused) return;

    // é™åˆ¶å ´ä¸ŠåŒæ™‚æœ€å¤š 8 å€‹æ°´æœ
    if (fruits.length >= 2) return;

    const isBomb = Math.random() < 0.2;
    const imgSrc = isBomb 
        ? bombImages[Math.floor(Math.random() * bombImages.length)] 
        : fruitImages[Math.floor(Math.random() * fruitImages.length)];

    const fruit = document.createElement('div');
    fruit.className = isBomb ? 'bomb' : 'fruit';
    fruit.dataset.type = isBomb ? 'bomb' : 'fruit';
    fruit.dataset.src = imgSrc;

    // åŠ åœ–ç‰‡
    const img = document.createElement('img');
    img.src = imgSrc;
    img.className = 'fruit-img';
    fruit.appendChild(img);

    // å¾è¢å¹•å››é‚Šéš¨æ©Ÿæ‹‹å‡º
    const side = Math.floor(Math.random() * 4);
    let startX, startY, targetX, targetY;

    switch(side) {
        case 0: // å·¦é‚Š
            startX = -50;
            startY = Math.random() * window.innerHeight;
            targetX = window.innerWidth + 50;
            targetY = Math.random() * window.innerHeight;
            break;
        case 1: // å³é‚Š
            startX = window.innerWidth + 50;
            startY = Math.random() * window.innerHeight;
            targetX = -50;
            targetY = Math.random() * window.innerHeight;
            break;
        case 2: // ä¸Šé‚Š
            startX = Math.random() * window.innerWidth;
            startY = -50;
            targetX = Math.random() * window.innerWidth;
            targetY = window.innerHeight + 50;
            break;
        case 3: // ä¸‹é‚Š
            startX = Math.random() * window.innerWidth;
            startY = window.innerHeight + 50;
            targetX = Math.random() * window.innerWidth;
            targetY = -50;
            break;
    }

    fruit.style.left = startX + 'px';
    fruit.style.top = startY + 'px';

    gameArea.appendChild(fruit);

    fruits.push({
        element: fruit,
        startX,
        startY,
        targetX,
        targetY,
        progress: 0,
        sliced: false
    });
}

// æ›´æ–°æ°´æœä½ç½®
function updateFruits() {
    if (isPaused) return;

    // å€’åºéæ­·ï¼Œé¿å… splice å‡ºéŒ¯
    for (let i = fruits.length - 1; i >= 0; i--) {
        let fruit = fruits[i];
        if (fruit.sliced) continue;

        fruit.progress += 0.008;

        // è¶…å‡ºç¯„åœ â†’ ç§»é™¤
        if (fruit.progress >= 1) {
            fruit.element.remove();
            fruits.splice(i, 1);
            continue;
        }

        // æ¨¡æ“¬æ‹‹ç‰©ç·šé‹å‹•
        const t = fruit.progress;
        const x = fruit.startX + (fruit.targetX - fruit.startX) * t;
        const y = fruit.startY + (fruit.targetY - fruit.startY) * t + Math.sin(t * Math.PI) * -200;

        fruit.element.style.left = x + 'px';
        fruit.element.style.top = y + 'px';
    }
}

        
        // æ»‘é¼ å’Œè§¸æ§äº‹ä»¶
        function startSlice(e) {
            if (isPaused) return;
            
            isDrawing = true;
            const rect = gameArea.getBoundingClientRect();
            lastX = (e.clientX || e.touches[0].clientX) - rect.left;
            lastY = (e.clientY || e.touches[0].clientY) - rect.top;
        }
        
        function slice(e) {
            if (!isDrawing || isPaused) return;
            
            e.preventDefault();
            const rect = gameArea.getBoundingClientRect();
            const currentX = (e.clientX || e.touches[0].clientX) - rect.left;
            const currentY = (e.clientY || e.touches[0].clientY) - rect.top;
            
            // å‰µå»ºåŠƒç·šæ•ˆæœ
            const line = document.createElement('div');
            line.className = 'slice-line';
            
            const dx = currentX - lastX;
            const dy = currentY - lastY;
            const length = Math.sqrt(dx * dx + dy * dy);
            const angle = Math.atan2(dy, dx) * 180 / Math.PI;
            
            line.style.left = lastX + 'px';
            line.style.top = lastY + 'px';
            line.style.width = length + 'px';
            line.style.transform = `rotate(${angle}deg)`;
            line.style.transformOrigin = '0 50%';
            
            gameArea.appendChild(line);
            sliceLines.push(line);
            
            // æª¢æŸ¥ç¢°æ’
            checkCollision(lastX, lastY, currentX, currentY);
            
            // æ¸…ç†èˆŠçš„åŠƒç·š
            setTimeout(() => {
                if (line.parentNode) {
                    line.remove();
                    const index = sliceLines.indexOf(line);
                    if (index > -1) sliceLines.splice(index, 1);
                }
            }, 200);
            
            lastX = currentX;
            lastY = currentY;
        }
        
        function endSlice() {
            isDrawing = false;
        }
        
        // ç¢°æ’æª¢æ¸¬
        function checkCollision(x1, y1, x2, y2) {
            fruits.forEach(fruit => {
                if (fruit.sliced) return;
                
                const rect = fruit.element.getBoundingClientRect();
                const gameRect = gameArea.getBoundingClientRect();
                const fruitX = rect.left - gameRect.left + rect.width / 2;
                const fruitY = rect.top - gameRect.top + rect.height / 2;
                
                // ç°¡å–®çš„ç·šæ®µèˆ‡é»çš„è·é›¢åˆ¤æ–·
                const distance = distanceToLine(x1, y1, x2, y2, fruitX, fruitY);
                
                if (distance < 70) { // ç¢°æ’é–¾å€¼
                    sliceFruit(fruit);
                }
            });
        }
        
        // è¨ˆç®—é»åˆ°ç·šæ®µçš„è·é›¢
        function distanceToLine(x1, y1, x2, y2, px, py) {
            const dx = x2 - x1;
            const dy = y2 - y1;
            const length = Math.sqrt(dx * dx + dy * dy);
            
            if (length === 0) return Math.sqrt((px - x1) * (px - x1) + (py - y1) * (py - y1));
            
            const t = Math.max(0, Math.min(1, ((px - x1) * dx + (py - y1) * dy) / (length * length)));
            const projectionX = x1 + t * dx;
            const projectionY = y1 + t * dy;
            
            return Math.sqrt((px - projectionX) * (px - projectionX) + (py - projectionY) * (py - projectionY));
        }
        

        // åœ–ç‰‡å°æ‡‰éŸ³æ•ˆ
const slicedSounds = {
    'imags/roc1.jpg': 'sounds/roc sound1.mp3',
    'imags/roc2.png': 'sounds/roc sound1.mp3',
    'imags/roc4.png': 'sounds/roc sound1.mp3',


    'imags/logo1.png': 'sounds/sound1.mp3',
    'imags/logo2.jpg': 'sounds/sound2.mp3',
    'imags/logo4.png': 'sounds/sound4.mp3',
    'imags/logo5.png': 'sounds/sound5.mp3',
    'imags/logo6.png': 'sounds/sound6.mp3',
    'imags/logo7.png': 'sounds/sound7.mp3',
    'imags/logo8.png': 'sounds/sound8.mp3',
    'imags/logo9.png': 'sounds/sound9.mp3',
    'imags/logo10.png': 'sounds/sound10.mp3',
    'imags/logo11.png': 'sounds/sound11.mp3',
    'imags/logo12.png': 'sounds/sound12.mp3',
    'imags/logo13.png': 'sounds/sound13.mp3',
    'imags/logo14.png': 'sounds/sound14.mp3',
    'imags/logo15.png': 'sounds/sound15.mp3',
    'imags/logo16.png': 'sounds/sound16.mp3',
    'imags/logo17.png': 'sounds/sound17.mp3',
    'imags/logo18.png': 'sounds/sound18.mp3',
    'imags/logo19.png': 'sounds/sound19.mp3',
    'imags/logo20.png': 'sounds/sound20.mp3',
    'imags/logo21.png': 'sounds/sound-21.mp3',
    
};

        function sliceFruit(fruit) {
    fruit.sliced = true;
    const isBomb = fruit.element.dataset.type === 'bomb';
    const originalSrc = fruit.element.dataset.src;

    // æ›æˆè¢«åˆ‡é–‹çš„åœ–ç‰‡
    const newSrc = slicedImages[originalSrc];
    fruit.element.querySelector('img').src = newSrc;
    fruit.element.classList.add('sliced');

    // æ’­æ”¾å°æ‡‰éŸ³æ•ˆ
    const soundSrc = slicedSounds[originalSrc];
    if (soundSrc) {
        const audio = new Audio(soundSrc);
        audio.play();
    }

    // æ›´æ–°åˆ†æ•¸
    if (isBomb) {
        score = Math.max(0, score - 5);
    } else {
        score += 5;
    }
    updateScore();

    // 0.8ç§’å¾Œç§»é™¤
    setTimeout(() => {
        if (fruit.element.parentNode) {
            fruit.element.remove();
        }
        const index = fruits.indexOf(fruit);
        if (index > -1) fruits.splice(index, 1);
    }, 800);
}
        
        // æ›´æ–°åˆ†æ•¸å’ŒæŒ‰éˆ•ç‹€æ…‹
        function updateScore() {
            scoreElement.textContent = score;
            
            // åªæœ‰ç•¶å‰åˆ†æ•¸è¶…éæœ¬å±€æœ€é«˜åˆ†æ•¸æ™‚æ‰æ›´æ–°è¨˜éŒ„
            if (score > sessionHighScore) {
                sessionHighScore = score;
                
                // å¦‚æœæœ¬å±€æœ€é«˜åˆ†æ•¸è¶…éæ­·å²æœ€é«˜åˆ†æ•¸ï¼Œæ›´æ–°æ­·å²è¨˜éŒ„
                if (sessionHighScore > highScore) {
                    highScore = sessionHighScore;
                    highScoreElement.textContent = highScore;
                    localStorage.setItem('fruitNinjaHighScore', highScore);
                }
            }
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.getElementById('specialBtn').disabled = score < 10;
            document.getElementById('blueBtn').disabled = score < 20;
            document.getElementById('redBtn').disabled = score < 50;
        }
        
        // ç‰¹æ®Šæ°´æœä¿®æ­£ï¼šimages/
const specialFruitMap = {
  'imags/logo1.png': { after: 'imags/logo1.jpg', sound: 'sounds/sound1.mp3' },
  'imags/logo2.jpg': { after: 'imags/logo2.jpg',  sound: 'sounds/sound2.mp3' },
  'imags/logo4.png': { after: 'imags/logo4.png', sound: 'sounds/sound4.mp3' },
  'imags/logo5.png': { after: 'imags/logo5.png', sound: 'sounds/sound5.mp3' },
  'imags/logo6.png': { after: 'imags/logo6.png', sound: 'sounds/sound6.mp3' },
  'imags/logo7.png':{ after: 'imags/logo7.png',sound: 'sounds/sound7.mp3' },


  'imags/logo21.png':{ after: 'imags/logo21.png',sound: 'sounds/sound21.mp3' },
};

// å¯é¸ï¼šç°¡å–®éŸ³æ•ˆå¿«å–
const audioCache = new Map();
function playSfx(path){
  let a = audioCache.get(path);
  if(!a){ a = new Audio(path); audioCache.set(path, a); }
  // é‡æ–°æ’­æ”¾ï¼ˆæœ‰äº›ç€è¦½å™¨éœ€ cloneNode æ‰èƒ½åŒæ™‚é‡æ’­ï¼‰
  a.currentTime = 0; a.play().catch(()=>{ /* éœé»˜å¤±æ•— */ });
}

function spawnSpecialFruit(){
  if (score < 10) return;
  score -= 10; updateScore();

  const keys = Object.keys(specialFruitMap);
  const originalImg = keys[(Math.random()*keys.length)|0];
  const fruitInfo = specialFruitMap[originalImg];

  const specialFruit = document.createElement('div');
  specialFruit.className = 'special-fruit';
  const img = document.createElement('img');
  img.src = originalImg; img.className = 'fruit-img';
  specialFruit.appendChild(img);

  // å‹•æ…‹å–å¾—å¯¬é«˜
  const size = 60;
  specialFruit.style.left = Math.max(0, Math.random()*(gameArea.offsetWidth  - size)) + 'px';
  specialFruit.style.top  = Math.max(0, Math.random()*(gameArea.offsetHeight - size)) + 'px';

  gameArea.appendChild(specialFruit);
  specialFruits.push(specialFruit);

  let cooling = false;
  const handleTouch = () => {
    if (cooling) return;
    cooling = true;

    specialFruit.classList.remove('touched');
    void specialFruit.offsetWidth;
    specialFruit.classList.add('touched');

    img.src = fruitInfo.after;
    playSfx(fruitInfo.sound);

    setTimeout(() => {
      img.src = originalImg;
      specialFruit.classList.remove('touched');
      cooling = false;
    }, 800);
  };
const isMobile = window.matchMedia('(max-width: 480px)').matches;

if (isMobile) {
 let isDragging = false;
let dragOffsetX = 0, dragOffsetY = 0;
let startX = 0, startY = 0;
const TAP_THRESHOLD = 5;

// æ–°å¢ï¼šæ‹–æ›³éç¨‹æ˜¯å¦å·²è§¸ç™¼é handleTouchï¼ˆé¿å…é€£ç™¼ï¼‰
let playedDuringDrag = false;
const DRAG_TRIGGER = 6; // è¶…é 6px è¦–ç‚ºé–‹å§‹æ‹–æ›³

specialFruit.addEventListener('pointerdown', (e) => {
  e.preventDefault(); e.stopPropagation();
  isDragging = true;
  startX = e.clientX; startY = e.clientY;

  playedDuringDrag = false; // æ¯æ¬¡æŒ‰ä¸‹é‡ç½®

  specialFruit.setPointerCapture?.(e.pointerId);

  const rect = specialFruit.getBoundingClientRect();
  dragOffsetX = e.clientX - rect.left;
  dragOffsetY = e.clientY - rect.top;
  specialFruit.style.zIndex = 1000;
});

specialFruit.addEventListener('pointermove', (e) => {
  if (!isDragging || !specialFruit.parentNode) return;
  e.preventDefault();

  const gameRect = gameArea.getBoundingClientRect();
  const w = specialFruit.offsetWidth  || 60;
  const h = specialFruit.offsetHeight || 60;

  let x = e.clientX - gameRect.left - dragOffsetX;
  let y = e.clientY - gameRect.top  - dragOffsetY;

  const maxX = Math.max(0, gameArea.clientWidth  - w);
  const maxY = Math.max(0, gameArea.clientHeight - h);

  x = Math.max(0, Math.min(x, maxX));
  y = Math.max(0, Math.min(y, maxY));

  specialFruit.style.left = x + 'px';
  specialFruit.style.top  = y + 'px';

  // æ‹–æ›³è¶…éé–€æª» â†’ è§¸ç™¼ä¸€æ¬¡éŸ³æ•ˆ/è®Šèº«
  if (!playedDuringDrag &&
      (Math.abs(e.clientX - startX) > DRAG_TRIGGER ||
       Math.abs(e.clientY - startY) > DRAG_TRIGGER)) {
    playedDuringDrag = true;
    handleTouch(); // å†·å»ç”± handleTouch å…§çš„ cooling æ§åˆ¶
  }
});

const endDrag = (e) => {
  if (!isDragging) return;
  e.preventDefault();

  const isTap =
    Math.abs(e.clientX - startX) < TAP_THRESHOLD &&
    Math.abs(e.clientY - startY) < TAP_THRESHOLD;

  isDragging = false;
  specialFruit.style.zIndex = 90;
  try { specialFruit.releasePointerCapture?.(e.pointerId); } catch {}

  // è‹¥æ˜¯é»æ“Šè€Œéæ‹–æ›³ï¼Œé€™è£¡å†è£œä¸€æ¬¡è§¸ç™¼
  if (isTap && !playedDuringDrag) {
    handleTouch();
  }
};

specialFruit.addEventListener('pointerup', endDrag);
specialFruit.addEventListener('pointercancel', endDrag);

} else {
  // ===== æ¡Œæ©Ÿï¼šæ²¿ç”¨ä½ åŸæœ¬çš„å¯«æ³•ï¼ˆä¿ç•™ï¼‰======
  specialFruit.addEventListener('click',      (e)=>{ e.stopPropagation(); handleTouch(); }, {passive:true});
  specialFruit.addEventListener('touchstart', (e)=>{ e.stopPropagation(); handleTouch(); }, {passive:true});

  let isDragging=false, dragOffsetX=0, dragOffsetY=0;
  specialFruit.addEventListener('mousedown', (e)=>{
    e.preventDefault(); e.stopPropagation();
    isDragging=true;
    const rect=specialFruit.getBoundingClientRect();
    dragOffsetX = e.clientX - rect.left;
    dragOffsetY = e.clientY - rect.top;
    specialFruit.style.zIndex=1000;
    handleTouch();
  });

  const onMove=(e)=>{
    if(!isDragging || !specialFruit.parentNode) return;
    const gameRect = gameArea.getBoundingClientRect();
    const clientX = e.clientX ?? (e.touches && e.touches[0].clientX);
    const clientY = e.clientY ?? (e.touches && e.touches[0].clientY);
    if(clientX==null) return;

    const w = specialFruit.offsetWidth  || 60;
    const h = specialFruit.offsetHeight || 60;

    let x = clientX - gameRect.left - dragOffsetX;
    let y = clientY - gameRect.top  - dragOffsetY;
    x = Math.max(0, Math.min(x, gameArea.offsetWidth  - w));
    y = Math.max(0, Math.min(y, gameArea.offsetHeight - h));
    specialFruit.style.left = x + 'px';
    specialFruit.style.top  = y + 'px';
  };

  const endDrag=()=>{ if(isDragging){ isDragging=false; specialFruit.style.zIndex=90; } };

  document.addEventListener('mousemove', onMove);
  document.addEventListener('mouseup',   endDrag, {once:false});
  document.addEventListener('touchmove', onMove,  {passive:false});
  document.addEventListener('touchend',  endDrag, {once:false});
}
}


// è—è‰²æŒ‰éˆ•å°ˆç”¨ â†’ { æ›èƒŒæ™¯ }
const blueBackgroundsDesktop = [
  
  'imags/pcbg1.jpg',
  'imags/pcbg2.jpg',
  'imags/pcbg3.jpg',
  'imags/pcbg4.jpg',
  'imags/pcbg5.jpg',
  'imags/pcbg6.jpg',
  'imags/pcbg7.jpg',
  'imags/pcbg8.jpg',
  'imags/pcbg9.jpg',
  'imags/pcbg10.jpg',
  'imags/pcbg11.jpg',
  'imags/pcbg12.jpg',
  'imags/pcbg13.jpg',
  'imags/pcbg14.jpg',
  'imags/pcbg15.jpg',
  'imags/pcbg16.jpg',
  'imags/pcbg17.jpg',
  'imags/pcbg18.jpg',
  'imags/pcbg19.jpg',
  'imags/pcbg20.jpg',
  'imags/pcbg21.jpg',
  'imags/pcbg22.jpg',
  'imags/pcbg23.jpg',
  'imags/pcbg24.jpg',
  'imags/pcbg25.jpg',



  
];

// æ‰‹æ©Ÿï¼ˆâ‰¤450pxï¼‰ç”¨èƒŒæ™¯
const blueBackgroundsMobile = [
  'imags/bg1.jpg',
 
  'imags/bg4.jpg',
  'imags/bg5.jpg',
  'imags/bg6.jpg',
  'imags/bg7.jpg',
  'imags/bg8.jpg',
  'imags/bg9.jpg',
  'imags/bg10.jpg',
  'imags/bg11.jpg',
  'imags/bg12.jpg',
  'imags/bg13.jpg',
  'imags/bg14.jpg',
  'imags/bg15.jpg',
  'imags/bg16.jpg',
  'imags/bg17.jpg',
  'imags/bg18.jpg',
  'imags/bg19.jpg',
  'imags/bg20.jpg',
  'imags/bg21.jpg',
  'imags/bg22.jpg',
  'imags/bg23.jpg',
  'imags/bg24.jpg',
  'imags/bg25.jpg',
  
  // â€¦æ”¾ä½ æƒ³çµ¦æ‰‹æ©Ÿç”¨çš„åœ–
];
// å–å¾—ç•¶å‰æ‡‰ç”¨çš„èƒŒæ™¯æ¸…å–®
function getBlueBackgrounds() {
  return window.matchMedia('(max-width: 450px)').matches
    ? blueBackgroundsMobile
    : blueBackgroundsDesktop;
}

function changeBackgroundRandomBlue() {
  if (score < 20) return; // æŒ‰éˆ•æ¶ˆè€— 20 åˆ†
  score -= 20;
  updateScore();

  const list = getBlueBackgrounds();
  if (!list.length) return;

  const randomImg = list[Math.floor(Math.random() * list.length)];
  gameArea.style.backgroundImage = `url(${randomImg})`;
  gameArea.style.backgroundSize = 'cover';
  gameArea.style.backgroundPosition = 'center';
}



// é«˜ç´šåœ–ç‰‡å°ˆç”¨ â†’ { after: è®Šèº«åœ–ç‰‡, sound: å°æ‡‰éŸ³æ•ˆ }
const redEffectMap = {
  'imags/sp logo1.png': { after: 'imags/sp logo1.png', sound: 'sounds/sound1.mp3' },
  'imags/sp logo2.png': { after: 'imags/sp logo2.png', sound: 'sounds/sound1.mp3' },
  'imags/sp logo3.png': { after: 'imags/sp logo3.png', sound: 'sounds/sound1.mp3' },
  'imags/sp logo4.png': { after: 'imags/sp logo4.png', sound: 'sounds/sound1.mp3' },
  'imags/sp logo5.png': { after: 'imags/sp logo5.png', sound: 'sounds/sound1.mp3' },
  'imags/sp logo6.png': { after: 'imags/sp logo6.png', sound: 'sounds/sound1.mp3' },
  'imags/sp logo7.png': { after: 'imags/sp logo7.png', sound: 'sounds/sound1.mp3' },
  

  
};
        
function spawnRedEffect() {
  if (score < 50) return; // æŒ‰éˆ•æ¶ˆè€— 50 åˆ†
  score -= 50;
  updateScore();

  // éš¨æ©ŸæŒ‘ä¸€å¼µ
  const keys = Object.keys(redEffectMap);
  const originalImg = keys[Math.floor(Math.random() * keys.length)];
  const effectInfo = redEffectMap[originalImg]; // after + sound

  const effectDiv = document.createElement('div');
  effectDiv.className = 'special-red';

  // åŠ åœ–ç‰‡
  const img = document.createElement('img');
  img.src = originalImg;
  img.className = 'fruit-img';
  effectDiv.appendChild(img);

  // éš¨æ©Ÿä½ç½®
  const baseSize = 60;
  effectDiv.style.left = Math.max(0, Math.random() * (gameArea.offsetWidth  - baseSize)) + 'px';
  effectDiv.style.top  = Math.max(0, Math.random() * (gameArea.offsetHeight - baseSize)) + 'px';

  gameArea.appendChild(effectDiv);

  // è§¸ç™¼ï¼šæ›åœ– + éŸ³æ•ˆ + å›åŸåœ–ï¼ˆå«å†·å»ï¼‰
  let cooling = false;
  const handleTouch = () => {
    if (cooling) return;
    cooling = true;

    effectDiv.classList.remove('touched');
    void effectDiv.offsetWidth;          // é‡æ–°è§¸ç™¼ CSS å‹•ç•«
    effectDiv.classList.add('touched');

    img.src = effectInfo.after;
    playSfx(effectInfo.sound);           // ğŸ” ç”¨å¿«å–éŸ³æ•ˆ

    setTimeout(() => {
      img.src = originalImg;
      effectDiv.classList.remove('touched');
      cooling = false;
    }, 800);
  };

  // â€”â€” ä¾è¢å¹•å¯¬åº¦é¸äº‹ä»¶æ¨¡å‹ï¼šâ‰¤480 ç”¨ Pointerï¼Œå…¶ä»–ç”¨åŸæœ¬æ¡Œæ©Ÿæ»‘é¼  â€”â€”
  const isMobile = window.matchMedia('(max-width: 480px)').matches;

  if (isMobile) {
    // ===== æ‰‹æ©Ÿ/å°è¢å¹•ï¼šPointer Events =====
    let isDragging = false;
let dragOffsetX = 0, dragOffsetY = 0;
let startX = 0, startY = 0;
const TAP_THRESHOLD = 5;

// âœ… æ–°å¢ï¼šæ‹–æ›³æ™‚æ˜¯å¦å·²è§¸ç™¼ééŸ³æ•ˆ/è®Šèº«
let playedDuringDrag = false;
const DRAG_TRIGGER = 6; // è¶…é 6px è¦–ç‚ºé–‹å§‹æ‹–æ›³

effectDiv.addEventListener('pointerdown', (e) => {
  e.preventDefault(); e.stopPropagation();
  isDragging = true;
  startX = e.clientX; startY = e.clientY;

  playedDuringDrag = false;      // âœ… æ¯æ¬¡æ–°æŒ‰ä¸‹å°±é‡ç½®

  effectDiv.setPointerCapture?.(e.pointerId);

  const rect = effectDiv.getBoundingClientRect();
  dragOffsetX = e.clientX - rect.left;
  dragOffsetY = e.clientY - rect.top;
  effectDiv.style.zIndex = 1000;
});

effectDiv.addEventListener('pointermove', (e) => {
  if (!isDragging || !effectDiv.parentNode) return;
  e.preventDefault();

  const gameRect = gameArea.getBoundingClientRect();
  const w = effectDiv.offsetWidth  || baseSize;
  const h = effectDiv.offsetHeight || baseSize;

  let x = e.clientX - gameRect.left - dragOffsetX;
  let y = e.clientY - gameRect.top  - dragOffsetY;

  const maxX = Math.max(0, gameArea.clientWidth  - w);
  const maxY = Math.max(0, gameArea.clientHeight - h);

  x = Math.max(0, Math.min(x, maxX));
  y = Math.max(0, Math.min(y, maxY));

  effectDiv.style.left = x + 'px';
  effectDiv.style.top  = y + 'px';

  // âœ… æ–°å¢ï¼šæ‹–æ›³è¶…éé–€æª»ï¼Œè§¸ç™¼ä¸€æ¬¡éŸ³æ•ˆ/è®Šèº«
  if (!playedDuringDrag &&
      (Math.abs(e.clientX - startX) > DRAG_TRIGGER ||
       Math.abs(e.clientY - startY) > DRAG_TRIGGER)) {
    playedDuringDrag = true;
    handleTouch(); // å†·å»æ©Ÿåˆ¶å·²åœ¨ handleTouch å…§è™•ç†
  }
});

const endDrag = (e) => {
  if (!isDragging) return;
  e.preventDefault();

  const isTap =
    Math.abs(e.clientX - startX) < TAP_THRESHOLD &&
    Math.abs(e.clientY - startY) < TAP_THRESHOLD;

  isDragging = false;
  effectDiv.style.zIndex = 90;
  try { effectDiv.releasePointerCapture?.(e.pointerId); } catch {}

  // é»æ“Šæ‰åœ¨é€™è£¡è§¸ç™¼ï¼›è‹¥æ‹–æ›³æ™‚å·²è§¸ç™¼éï¼Œå°±ä¸å†æ’­
  if (isTap && !playedDuringDrag) {
    handleTouch();
  }
};

effectDiv.addEventListener('pointerup', endDrag);
effectDiv.addEventListener('pointercancel', endDrag);
  } else {
    // ===== æ¡Œæ©Ÿï¼šæ²¿ç”¨ä½ åŸæœ¬çš„æ»‘é¼ äº‹ä»¶ =====
    // é»æ“Š/è§¸æ§ï¼ˆæ²¿ç”¨èˆŠé‚è¼¯ï¼‰
    effectDiv.addEventListener('click',      (e) => { e.stopPropagation(); handleTouch(); }, { passive: true });
    effectDiv.addEventListener('touchstart', (e) => { e.stopPropagation(); handleTouch(); }, { passive: true });

    // æ‹–æ›³
    let isDragging = false;
    let dragOffsetX = 0, dragOffsetY = 0;

    effectDiv.addEventListener('mousedown', (e) => {
      e.preventDefault(); e.stopPropagation();
      isDragging = true;
      const rect = effectDiv.getBoundingClientRect();
      dragOffsetX = e.clientX - rect.left;
      dragOffsetY = e.clientY - rect.top;
      effectDiv.style.zIndex = 1000;
      handleTouch(); // è‹¥ä½ å¸Œæœ›æ‹–æ›³é–‹å§‹å°±æœ‰ç‰¹æ•ˆï¼Œä¿ç•™é€™è¡Œ
    });

    const onMove = (e) => {
      if (!isDragging || !effectDiv.parentNode) return;
      e.preventDefault();
      const gameRect = gameArea.getBoundingClientRect();

      const w = effectDiv.offsetWidth  || baseSize;
      const h = effectDiv.offsetHeight || baseSize;

      let x = e.clientX - gameRect.left - dragOffsetX;
      let y = e.clientY - gameRect.top  - dragOffsetY;
      x = Math.max(0, Math.min(x, gameArea.offsetWidth  - w));
      y = Math.max(0, Math.min(y, gameArea.offsetHeight - h));
      effectDiv.style.left = x + 'px';
      effectDiv.style.top  = y + 'px';
      
    };

    const endDrag = () => {
      if (isDragging) {
        isDragging = false;
        effectDiv.style.zIndex = 90;
      }
    };

    document.addEventListener('mousemove', onMove);
    document.addEventListener('mouseup',   endDrag, { once: false });
    document.addEventListener('touchmove', onMove,  { passive: false });
    document.addEventListener('touchend',  endDrag, { once: false });
  }
}


const playlist = [
  { title: 'friends forever', src: 'sounds/song1.mp3' },
  { title: 'Route 1', src: 'sounds/song2.mp3' },
  { title: 'PokÃ©mon Center', src: 'sounds/song3.mp3' },
];

// ======= å…ƒä»¶æŠ“å– =======
const audio   = document.getElementById('audioPlayer');
audio.loop = true;
const titleEl = document.getElementById('trackTitle');
const btnPrev = document.getElementById('btnPrev');
const btnPlay = document.getElementById('btnPlay');
const btnNext = document.getElementById('btnNext');
const iconPlay  = document.getElementById('iconPlay');
const iconPause = document.getElementById('iconPause');

let current = 0;

// ======= è¼‰å…¥/æ›´æ–° =======
function loadTrack(i){
  current = (i + playlist.length) % playlist.length;
  const track = playlist[current];
  audio.src = track.src;
  titleEl.textContent = track.title || 'æœªå‘½å';
}

function next(){ loadTrack(current+1); play(); }
function prev(){ loadTrack(current-1); play(); }

function play(){
  audio.play().then(()=>{
    iconPlay.style.display = 'none';
    iconPause.style.display = '';
  }).catch(()=>{/* è‡ªå‹•æ’­æ”¾è¢«ç€è¦½å™¨é˜»æ“‹å°±ä¿æŒæš«åœç‹€æ…‹ */});
}

function pause(){
  audio.pause();
  iconPlay.style.display = '';
  iconPause.style.display = 'none';
}

function toggle(){
  if (audio.paused) play(); else pause();
}

function next(){ loadTrack(current+1); play(); }
function prev(){ loadTrack(current-1); play(); }

// ======= ç¶äº‹ä»¶ =======
btnPlay.addEventListener('click', toggle);
btnNext.addEventListener('click', next);
btnPrev.addEventListener('click', prev);


// åˆå§‹è¼‰å…¥ç¬¬ä¸€é¦–ï¼ˆä¸è‡ªå‹•æ’­æ”¾ï¼‰
loadTrack(0);
pause();


// å»ºç«‹åµæ¸¬å™¨å…ƒç´ 
const statsPanel = document.createElement("div");
statsPanel.style.position = "fixed";
statsPanel.style.bottom = "10px";
statsPanel.style.left = "10px";
statsPanel.style.background = "rgba(0,0,0,0.6)";
statsPanel.style.color = "#0f0";
statsPanel.style.fontSize = "14px";
statsPanel.style.padding = "5px 10px";
statsPanel.style.borderRadius = "6px";
statsPanel.style.fontFamily = "monospace";
statsPanel.style.zIndex = "9999";
document.body.appendChild(statsPanel);

// FPS è¨ˆç®—
let lastTime = performance.now();
let frameCount = 0;
let fps = 0;

function updateStats() {
    const now = performance.now();
    frameCount++;

    if (now - lastTime >= 1000) { // æ¯ç§’æ›´æ–°ä¸€æ¬¡ FPS
        fps = frameCount;
        frameCount = 0;
        lastTime = now;
    }

    // é¡¯ç¤º FPS èˆ‡å ´ä¸Šæ°´æœæ•¸é‡
    statsPanel.textContent = `FPS: ${fps} | Fruits: ${fruits.length}`;
    
    requestAnimationFrame(updateStats);
}

// å•Ÿå‹•ç›£æ¸¬
updateStats();


        // æš«åœ/ç¹¼çºŒ
        function togglePause() {
            isPaused = !isPaused;
            pauseBtn.textContent = isPaused ? 'start (é–‹å§‹)' : 'stop (æš«åœ)';
        }
        
        // é‡æ–°é–‹å§‹
function restartGame() {
    score = 0;
    sessionHighScore = 0; // é‡ç½®æœ¬å±€æœ€é«˜åˆ†æ•¸
    isPaused = false;
    updateScore();
    pauseBtn.textContent = 'stop (æš«åœ)';

    // æ¸…é™¤æ‰€æœ‰æ°´æœå’Œç‰¹æ®Šæ•ˆæœ
    fruits.forEach(fruit => fruit.element.remove());
    specialFruits.forEach(fruit => fruit.remove());
    sliceLines.forEach(line => line.remove());

    // âœ… æ–°å¢ï¼šæ¸…é™¤æ‰€æœ‰ .special-red åœ–æ¡ˆ
    document.querySelectorAll('.special-red').forEach(el => el.remove());

    // æ¸…ç©ºé™£åˆ—
    fruits = [];
    specialFruits = [];
    sliceLines = [];

    // é‡ç½®èƒŒæ™¯
    document.body.className = '';
    gameArea.className = 'game-area';
}
        
        // äº‹ä»¶ç›£è½å™¨
        gameArea.addEventListener('mousedown', startSlice);
        gameArea.addEventListener('mousemove', slice);
        gameArea.addEventListener('mouseup', endSlice);
        
        gameArea.addEventListener('touchstart', startSlice, { passive: false });
        gameArea.addEventListener('touchmove', slice, { passive: false });
        gameArea.addEventListener('touchend', endSlice);
        
        // éŠæˆ²ä¸»å¾ªç’°
        setInterval(() => {
            if (Math.random() < 0.02) { // 2% æ©Ÿç‡æ¯å¹€ç”Ÿæˆæ°´æœ
                spawnFruit();
            }
            updateFruits();
        }, 16); // ~60 FPS
    </script>
    <script>
    function toggleDrawer(btn){
      const collapsed = document.body.classList.toggle('drawer-collapsed');
      btn.textContent = collapsed ? 'â¬‡' : 'â¬†';
      btn.setAttribute('aria-expanded', String(!collapsed));
    }
  </script>
  <div class="credit">æ„Ÿè¬ é»ƒéŸ‹å‚‘å­¸è€… æä¾›</div>
</body>

</html>